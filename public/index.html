<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Log Hub - Login Errors</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .error-table {
            width: 100%;
            margin-top: 20px;
        }
        .pagination {
            margin-top: 20px;
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Game Log Hub - Login Errors</h1>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addErrorModal">Add Test Error</button>
        </div>

        <div class="row mb-3">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Total Errors</h5>
                        <h2 id="total-count">0</h2>
                    </div>
                </div>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-striped error-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>User ID</th>
                        <th>Username</th>
                        <th>Error Type</th>
                        <th>Error Message</th>
                        <th>IP</th>
                        <th>Platform</th>
                        <th>Device</th>
                        <th>Time</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="error-table-body">
                    <!-- Data will be populated here -->
                </tbody>
            </table>
        </div>

        <div class="pagination">
            <nav>
                <ul class="pagination" id="pagination-container">
                    <!-- Pagination will be populated here -->
                </ul>
            </nav>
        </div>
    </div>

    <!-- Add Error Modal -->
    <div class="modal fade" id="addErrorModal" tabindex="-1" aria-labelledby="addErrorModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addErrorModalLabel">Add Test Login Error</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="add-error-form">
                        <div class="mb-3">
                            <label for="userId" class="form-label">User ID</label>
                            <input type="text" class="form-control" id="userId" value="12345">
                        </div>
                        <div class="mb-3">
                            <label for="userName" class="form-label">Username</label>
                            <input type="text" class="form-control" id="userName" value="testuser">
                        </div>
                        <div class="mb-3">
                            <label for="errorType" class="form-label">Error Type</label>
                            <select class="form-control" id="errorType">
                                <option value="authentication_failed">Authentication Failed</option>
                                <option value="account_locked">Account Locked</option>
                                <option value="invalid_credentials">Invalid Credentials</option>
                                <option value="server_error">Server Error</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="errorMsg" class="form-label">Error Message</label>
                            <input type="text" class="form-control" id="errorMsg" value="Invalid username or password">
                        </div>
                        <div class="mb-3">
                            <label for="ip" class="form-label">IP Address</label>
                            <input type="text" class="form-control" id="ip" value="192.168.1.1">
                        </div>
                        <div class="mb-3">
                            <label for="platform" class="form-label">Platform</label>
                            <select class="form-control" id="platform">
                                <option value="Windows">Windows</option>
                                <option value="iOS">iOS</option>
                                <option value="Android">Android</option>
                                <option value="macOS">macOS</option>
                                <option value="Linux">Linux</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="device" class="form-label">Device</label>
                            <input type="text" class="form-control" id="device" value="Desktop">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="submit-error">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentPage = 1;
        const pageSize = 10;
        let totalRecords = 0;

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadData();

            // Setup event listeners
            document.getElementById('submit-error').addEventListener('click', addLoginError);
        });

        // Load login errors data
        function loadData() {
            fetch(`/api/login-errors?page=${currentPage}&page_size=${pageSize}`)
                .then(response => response.json())
                .then(data => {
                    displayData(data);
                })
                .catch(error => {
                    console.error('Error fetching login errors:', error);
                });
        }

        // Display data in the table
        function displayData(data) {
            const tableBody = document.getElementById('error-table-body');
            tableBody.innerHTML = '';
            
            totalRecords = data.total;
            document.getElementById('total-count').textContent = totalRecords;

            if (data.data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="10" class="text-center">No login errors found</td></tr>';
                return;
            }

            data.data.forEach(error => {
                const row = document.createElement('tr');
                const created = new Date(error.created_at);
                
                row.innerHTML = `
                    <td>${error.id}</td>
                    <td>${error.user_id}</td>
                    <td>${error.user_name}</td>
                    <td>${error.error_type}</td>
                    <td>${error.error_msg}</td>
                    <td>${error.ip}</td>
                    <td>${error.platform}</td>
                    <td>${error.device}</td>
                    <td>${created.toLocaleString()}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteError(${error.id})">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            updatePagination(data.total, data.page, data.size);
        }

        // Update pagination controls
        function updatePagination(total, currentPage, pageSize) {
            const pageCount = Math.ceil(total / pageSize);
            const paginationContainer = document.getElementById('pagination-container');
            paginationContainer.innerHTML = '';

            // Previous button
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage - 1})">Previous</a>`;
            paginationContainer.appendChild(prevLi);

            // Page numbers
            for (let i = 1; i <= pageCount; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === currentPage ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i})">${i}</a>`;
                paginationContainer.appendChild(li);
            }

            // Next button
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === pageCount ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage + 1})">Next</a>`;
            paginationContainer.appendChild(nextLi);
        }

        // Change page
        function changePage(page) {
            if (page < 1 || (totalRecords > 0 && page > Math.ceil(totalRecords / pageSize))) {
                return;
            }
            currentPage = page;
            loadData();
        }

        // Add a new login error
        function addLoginError() {
            const data = {
                user_id: document.getElementById('userId').value,
                user_name: document.getElementById('userName').value,
                error_type: document.getElementById('errorType').value,
                error_msg: document.getElementById('errorMsg').value,
                ip: document.getElementById('ip').value,
                platform: document.getElementById('platform').value,
                device: document.getElementById('device').value
            };

            fetch('/api/login-errors/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to add login error');
                }
                return response.json();
            })
            .then(result => {
                // Close the modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addErrorModal'));
                modal.hide();
                
                // Reload data
                loadData();
            })
            .catch(error => {
                console.error('Error adding login error:', error);
                alert('Failed to add login error: ' + error.message);
            });
        }

        // Delete a login error
        function deleteError(id) {
            if (!confirm('Are you sure you want to delete this login error?')) {
                return;
            }

            fetch(`/api/login-errors/${id}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to delete login error');
                }
                return response.json();
            })
            .then(result => {
                loadData();
            })
            .catch(error => {
                console.error('Error deleting login error:', error);
                alert('Failed to delete login error: ' + error.message);
            });
        }
    </script>
</body>
</html> 